{% extends 'layout/base.html' %}

{% block content %}

{# DELETE BUTTON FOR ADMINS ONLY #}
{% with discussion as obj %}
    {% include 'perm/editable_logic.html' %}
{% endwith %}

{# DISCUSSION TEXT AND TITLE #}
<h2>{{discussion.title}}</h2>
<p>{{discussion.text}}</p>
<p><i>posted by {% with discussion.created_by as u %}<a href="/accounts/{{u.pk}}/">{{u.first_name}} {{u.last_name}}</a>{% endwith %} &nbsp; at {{discussion.created_at}}. {{discussion.comment_count}} comments, {{discussion.proposal_count}} secrets</i></p>

{# REPLY FORM #}
<h4>Post a reply</h4>
{% form reply_form %}
    {% for f in reply_form %}
        {% field f %}
        {% ifequal f.name "secrets" %}
          <p style="margin-bottom:30px;margin-top:-48px;text-align:right;width:600px;"><a href="/secret/new/" target="_blank">New secret</a></p>
        {% endifequal %}
    {% endfor %}
{% endform %}

{# DISCUSSION COMMENTS #}
<br class="clear"/><br />
<h3>Comments</h3>
{% for c in discussion.page_comments %}
    <div>
        <p>{{c.text}}</p>
        <p><i>posted by {% with c.created_by as u %}<a href="/accounts/{{u.pk}}/">{{u.first_name}} {{u.last_name}}</a>{% endwith %} &nbsp; at {{c.created_at}}.</i></p>
    </div>
    {% for s in c.viewable_secrets %}
        <a href="{{s.get_absolute_url}}">{{s.title}}</a>, 
    {% endfor %}
    <br/><br />
    {% with c as obj %}{% include 'perm/editable_logic.html' %}{% endwith %}
    <hr />
{% endfor %}

{# PAGES AND LINKS #}

<ul>
    {% if discussion.previous_page %}<li><a href="?page={{discussion.previous_page}}">previous</a></li>{% endif %}
    {% for p in discussion.xpages %}
        <li>{% ifequal p discussion.page %}<b>{{p}}</b>{% else %}<a href="?page={{p}}">{{p}}</a>{% endifequal %}</li>
    {% endfor %}
    {% if discussion.next_page %}<li><a href="?page={{discussion.next_page}}">next</a></li>{% endif %}
</ul>

{% endblock %}
